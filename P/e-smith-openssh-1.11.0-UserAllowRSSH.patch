diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowCVS mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowCVS
--- e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowCVS	2006-03-13 20:01:07.833284362 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowCVS	1970-01-01 10:00:00.000000000 +1000
@@ -1 +0,0 @@
-no
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowRDIST mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowRDIST
--- e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowRDIST	2006-03-13 20:01:07.834284189 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowRDIST	1970-01-01 10:00:00.000000000 +1000
@@ -1 +0,0 @@
-no
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowRSYNC mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowRSYNC
--- e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowRSYNC	2006-03-13 20:01:07.837283670 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowRSYNC	1970-01-01 10:00:00.000000000 +1000
@@ -1 +0,0 @@
-yes
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowSCP mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowSCP
--- e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowSCP	2006-03-13 20:01:07.834284189 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowSCP	1970-01-01 10:00:00.000000000 +1000
@@ -1 +0,0 @@
-yes
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowSFTP mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowSFTP
--- e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowSFTP	2006-03-13 20:01:07.834284189 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/db/configuration/defaults/sshd/AllowSFTP	1970-01-01 10:00:00.000000000 +1000
@@ -1 +0,0 @@
-yes
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowcvs mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowcvs
--- e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowcvs	2006-03-13 20:01:07.835284016 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowcvs	1970-01-01 10:00:00.000000000 +1000
@@ -1,3 +0,0 @@
-{
-    return "allowcvs" if ($sshd{AllowCVS} eq "yes");
-}
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowrdist mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowrdist
--- e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowrdist	2006-03-13 20:01:07.835284016 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowrdist	1970-01-01 10:00:00.000000000 +1000
@@ -1,3 +0,0 @@
-{
-    return "allowrdist" if ($sshd{AllowRDIST} eq "yes");
-}
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowrsync mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowrsync
--- e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowrsync	2006-03-13 20:01:07.836283843 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowrsync	1970-01-01 10:00:00.000000000 +1000
@@ -1,3 +0,0 @@
-{
-    return "allowrsync" if ($sshd{AllowRSYNC} eq "yes");
-}
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowscp mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowscp
--- e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowscp	2006-03-13 20:01:07.836283843 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowscp	1970-01-01 10:00:00.000000000 +1000
@@ -1,3 +0,0 @@
-{
-    return "allowscp" if ($sshd{AllowSCP} eq "yes");
-}
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowsftp mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowsftp
--- e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowsftp	2006-03-13 20:01:07.836283843 +1100
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/20allowsftp	1970-01-01 10:00:00.000000000 +1000
@@ -1,3 +0,0 @@
-{
-    return "allowsftp" if ($sshd{AllowSFTP} eq "yes");
-}
diff -Nur -x '*.orig' -x '*.rej' e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/40users mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/40users
--- e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/40users	1970-01-01 10:00:00.000000000 +1000
+++ mezzanine_patched_e-smith-openssh-1.11.0/root/etc/e-smith/templates/etc/rssh.conf/40users	2006-03-13 19:58:18.635521858 +1100
@@ -0,0 +1,18 @@
+{
+    use esmith::AccountsDB;
+
+    my $adb = esmith::AccountsDB->open_ro or die "Couldn't open AccountsDB\n";
+
+    $OUT = '';
+
+    for my $user ( $adb->users )
+    {
+	my %props = $user->props;
+
+	next unless ($props{PasswordSet} eq 'yes');
+
+	next unless ($props{AllowRSSH} eq 'yes');
+
+	$OUT .= "user = " . $user->key . ":022:11111:";
+    }
+}
