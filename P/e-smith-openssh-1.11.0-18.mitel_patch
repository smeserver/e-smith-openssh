Index: e-smith-openssh/e-smith-openssh.spec
diff -u e-smith-openssh/root/etc/e-smith/events/actions/sshd-conf:1.6 e-smith-openssh/root/etc/e-smith/events/actions/sshd-conf:1.7
--- e-smith-openssh/root/etc/e-smith/events/actions/sshd-conf:1.6	Mon Mar 14 11:47:07 2005
+++ e-smith-openssh/root/etc/e-smith/events/actions/sshd-conf	Tue Jul 19 17:18:11 2005
@@ -1,7 +1,7 @@
 #!/usr/bin/perl -w
 
 #----------------------------------------------------------------------
-# copyright (C) 1999 e-smith, inc.
+# copyright (C) 1999-2005 Mitel Networks Corporation
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -17,18 +17,14 @@
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307  USA
 #
-# Technical support for this program is available from e-smith, inc.
-# For details, please visit our web site at www.e-smith.com or
-# call us on 1 888 ESMITH 1 (US/Canada toll free) or +1 613 564 8000
 #----------------------------------------------------------------------
 
 package esmith;
 
 use strict;
 use Errno;
-use esmith::config;
+use esmith::ConfigDB;
 use esmith::util;
-use esmith::templates;
 
 =head1 NAME
 
@@ -86,8 +82,7 @@
 
 =cut
 
-my %conf;
-tie %conf, 'esmith::config';
+my $db = esmith::ConfigDB->open_ro or die "Could not open config db";
 
 # Recomment the key in case the SystemName or DomainName changed.
 my @change = (-f "/etc/ssh/ssh_host_key") ? ("-c", "-P", "")
@@ -96,7 +91,7 @@
 esmith::util::backgroundCommand (0,
     "/usr/bin/ssh-keygen", @change, "-t", "rsa1",
     "-f", "/etc/ssh/ssh_host_key",
-    "-C", "root@" . $conf{'SystemName'} . "." . $conf{'DomainName'});
+    "-C", "root@" . $db->get('SystemName')->value . "." . $db->get('DomainName')->value);
 
 exit (0);
 
Index: e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/00intro
diff -u e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/00intro:1.1.1.1 e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/00intro:removed
--- e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/00intro:1.1.1.1	Thu Feb 14 15:51:15 2002
+++ e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/00intro	Wed Dec 31 19:00:00 1969
@@ -1,3 +0,0 @@
-{
-    use esmith::db;
-}
Index: e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/15ListenAddress
diff -u e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/15ListenAddress:1.1.1.1 e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/15ListenAddress:1.2
--- e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/15ListenAddress:1.1.1.1	Thu Feb 14 15:51:15 2002
+++ e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/15ListenAddress	Tue Jul 19 17:18:12 2005
@@ -1,8 +1,5 @@
 {
-    local %services;
-    $services{'sshd'} = $sshd;
-
-    local $access = db_get_prop(\%services, 'sshd', 'access');
+    my $access = $sshd{'access'} || 'private';
 
     my $address = ($access eq "public") ? "0.0.0.0" : "$LocalIP";	
 
Index: e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PasswordAuthentication
diff -u e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PasswordAuthentication:1.1.1.1 e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PasswordAuthentication:1.2
--- e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PasswordAuthentication:1.1.1.1	Thu Feb 14 15:51:15 2002
+++ e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PasswordAuthentication	Tue Jul 19 17:18:12 2005
@@ -1,12 +1,6 @@
-{ # To disable tunneled clear text passwords, change to no here! }
-PasswordAuthentication { 
-    local %services;
-    $services{'sshd'} = $sshd;
+{ # To disable tunneled clear text passwords, change to no here!
+    my $PasswordAuthentication = $sshd{'PasswordAuthentication'} || 'no';
 
-    my $PasswordAuthentication =
-	db_get_prop(\%services, "sshd", "PasswordAuthentication");
-
-    $PasswordAuthentication = "no" unless defined $PasswordAuthentication;
-
-    $OUT = ($PasswordAuthentication eq "yes") ? "yes" : "no";
+    $OUT = "PasswordAuthentication ";
+    $OUT .= ($PasswordAuthentication eq "yes") ? "yes" : "no";
 }
Index: e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PermitRootLogin
diff -u e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PermitRootLogin:1.1.1.1 e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PermitRootLogin:1.2
--- e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PermitRootLogin:1.1.1.1	Thu Feb 14 15:51:15 2002
+++ e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/40PermitRootLogin	Tue Jul 19 17:18:12 2005
@@ -1,11 +1,5 @@
-PermitRootLogin { 
-    local %services;
-    $services{'sshd'} = $sshd;
-
-    my $PermitRootLogin =
-	db_get_prop(\%services, "sshd", "PermitRootLogin");
-
-    $PermitRootLogin = "no" unless defined $PermitRootLogin;
-
-    $OUT = ($PermitRootLogin eq "yes") ? "yes" : "no";
+{ 
+    my $PermitRootLogin = $sshd{'PermitRootLogin'} || "no";
+    $OUT = "PermitRootLogin ";
+    $OUT .= ($PermitRootLogin eq "yes") ? "yes" : "no";
 }
Index: e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/50SubsystemSftp
diff -u e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/50SubsystemSftp:1.1.1.1 e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/50SubsystemSftp:1.2
--- e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/50SubsystemSftp:1.1.1.1	Thu Feb 14 15:51:15 2002
+++ e-smith-openssh/root/etc/e-smith/templates/etc/ssh/sshd_config/50SubsystemSftp	Tue Jul 19 17:18:12 2005
@@ -3,10 +3,7 @@
     #       With this disabled, you can still specify a path to the sftp client
     #       so we default to enabling sftp
 
-    my %services = ( sshd => $sshd );
-
-    my $SubsystemSftp =
-        db_get_prop(\%services, "sshd", "SubsystemSftp") || "yes";
+    my $SubsystemSftp = $sshd{"SubsystemSftp"} || "yes";
 
     $OUT = ($SubsystemSftp eq "yes") ? 
 	"Subsystem      sftp    /usr/libexec/openssh/sftp-server" : 
